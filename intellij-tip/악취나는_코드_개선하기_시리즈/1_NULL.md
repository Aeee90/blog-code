# 1. Code Smells: Null

리팩토링에 대한 연구 중에 저는 여러가지 패턴(냄새나는 패턴)이 계속해서 반복되는 것을 보았습니다.  
  
이런 패턴들은 특별히 새로운 것이 하나도 없으며, 많은 책들([리팩토링](http://www.yes24.com/24/goods/7951038?scode=032&OzSrank=1), [패턴을 활용한 리팩토링](http://www.yes24.com/24/goods/14752528?scode=032&OzSrank=2))과 [블로그](https://refactoring.com/) 및 [동영상](https://www.youtube.com/watch?v=y4_SJzNJnXU&feature=youtu.be) 에서 이런 냄새나는 패턴들을 어떻게 다루는지 알려주고 있습니다.  
하지만 저는 IntelliJ IDEA가 어떻게 당신을 도울 수 있는지 (아닐 수도 있지만) 몇 가지 구체적이고 사소한 예로 설명하고 싶었습니다.  
  
내가 반대하려는 첫 번째 문제는 **null을 사용하는 것**입니다.  
특히 null-check 코드가 주위에 흩어져있을 때 더욱 그렇습니다.  
  
Java 8의 ```Optional```은 이러한 많은 문제를 해결해야 한다고 생각했습니다.  
저는 그것이 null 일 수 있다고 명시하는 유형, 즉 **이러한 경우에는 무엇을 해야 하는지를 명확히 알려주는 것이 정확히 올바른 해결책**이라고 생각했습니다.  
  
그러나 사태가 그렇게 단순하지는 않았습니다.  
그래서 이것은 IntelliJ에서 의도적으로 지원하지 않는 것이라 생각합니다.  
오히려 실망스럽게도, 이것은 개발자가 해야 할 일에 대해 열심히 생각할 필요가 있는 영역입니다.  
  
우리는 ```null```이 많은 것을 의미한다는 사실에 동의해야합니다.  
의미 할 수있는 것들 :

1. 값이 실수로 또는 의도적으로 초기화되지 않음.
2. 유요하지 않은 값.
3. 필요 없는 값.
4. 값이 없음.
5. 끔찍한 잘못이 있었고 있어야 할 것이 없음.
6. ... 아마도 수십 가지 다른 것들

명확한 설계 목표를 가진 훈련 된 팀이라면, 이 중 일부는 코드 기반에 적용되지 않는다고 가정 할 수 있습니다.  
  
예를 들어, 생성자에서 항상 초기화되는 최종 필드를 사용하거나, 인스턴스 생성 전에 올바른 조합을 검증하기 위해 빌더 또는 팩토리를 사용하거나, 응용 프로그램의 핵심에서 널 (null)을 사용하지 않는 등등  
  
```Optional```은 이러한 케이스 중 하나를 해결해줍니다. (위 4번째 사례 : 값이 없는 경우)  
예를 들어 데이터베이스에 특정 ID가 있는 고객을 요청합니다.  
이전에는 ```null```이 이를 표현 하곤 했었지만 모호 할 수 있습니다.  
```null```이 리턴될 경우에,  
이는 고객을 찾을 수 없다는 뜻입니까?  
또는 ID가 있지만 값이 없는 고객이 있습니까? 
또는 데이터베이스 연결이 실패했기 때문에 ```null```이 반환 되었습니까?  
```null```대신에 ```Empty Optional```을 리턴함으로써 모호성을 제거할 수 있게 되었습니다.- 해당 ID를 가진 고객은 없습니다.  
  
수많은 사람들이 작업 한 정상적이고 많은 코드 사이에서 **우리의 모든 ```null```이 무엇을 의미하는지**, 그리고 그것들에 대해 **무엇을 해야 하는지**를 말할 수 있습니까?  
아주 작은 부분부터 조금씩 진행해보겠습니다.

## 사례 연구

여기에서는 [Morphia 프로젝트](https://github.com/mongodb/morphia)를 예로 사용합니다.  
이것은 
* 오픈 소스이며, 
* 쉽게 다운로드하고 탐색 할 수 있을 만큼 작고 
* 실제 사용할수 있을만큼의 프로덕션 레벨 코드이기 때문에 

훌륭한 예제 프로젝트입니다.  

## The Smell: return null

먼저 ```null```이 명시적으로 반환 된 모든 곳을 찾아보았습니다.  
(Mac 기준 : ```Command+shift+f```)  
  
이렇게 ```null```을 리턴하는 메소드들은 ```Optional```로 대체할 수 있다고 생각합니다.

![1_findpath](./images/1_findpath.png)

### 예제1. Converter.decode ()

프로젝트의 많은 ```XXXConverter``` 클래스들이 ```decode```메서드에서 null 값을 반환하는 것으로 보이기 때문에 ```Converter```의 부모 클래스 (```TypeConverter```란 이름의 추상클래스)에서 ```Optional```을 반환 하도록 변경하는 것이 좋습니다.  
그러나 코드를 자세히 살펴보면 실제로 무슨일이 일어나는지 알수 있습니다.  
동일한 패턴이 계속 반복해서 발생하는 것을 볼 수 있습니다.  
메서드는 전달 된 값이 ```null```인지 확인하고 ```null```일 경우 다시 ```null```을 반환합니다.

![1_decode](./images/1_decode.png)

첫 번째 질문은 "```fromDBObject```는 실제로 ```null```일 수 있습니까?"입니다.  
코드가 복잡하기 때문에 확실하게 말할수는 없지만 **데이터베이스에서 가져온 값이므로 이론적으로는 그럴 수 있을것 같습니다**.  
  
Quick Search는 이 메소드의 모든 인스턴스가 실제로는 하나의 중앙 위치에서만 호출된다는 것을 보여주기 때문에 21 개 장소에서 이 ```null```체크를 수행하는 대신 한 곳에서 수행할 수 있고, 거기에서 더 이상 ```fromDBObject```는 ```null```이 될 수 없다는 것을 보여줍니다.




