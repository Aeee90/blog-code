# Nginx 리버스 프록시
일정 수준 이상의 규모를 가진 웹 사이트에서는 웹 서버(Apache 혹은 Nginx)와 웹 어플리케이션 서버 (Tomcat)를 분리하여 웹 서버를 리버스 프록시 서버(Reverse Proxy Server)로 사용합니다.<br/>

서비스의 도메인을 리버스 프록시로 등록하여 (예를 들어 zum.com이란 요청이 오게 되면 )사용자의 요청 (클라이언트)은 리버스 프록시 서버로
여기서 얘기하는 리버스는 **역전** 이란 뜻이 아닌 **뒷쪽** 이란 뜻이라고 생각하면 됩니다. <br/>
자세한 내용은 [joinc님의 포스팅](http://www.joinc.co.kr/w/man/12/proxy)을 참조하시면 더욱 이해하기 쉬울것 같습니다. <br/>

## Nginx 캐시 문제
아래에서 사용한 예제 코드의 경우 모두 [Github]()
**Nginx 실행여부 확인**
```
ps auxww |grep nginx
```

![Nginx 확인](./images/nginx확인.png)


### 캐시 용량 문제
최근 zum.com에서는 두들 캠페인을 진행하였습니다. <br/>

![두들 캠페인](./images/두들캠페인.png)

(화면 좌측의 더 넓은 검색 부분입니다.) <br/>
사용자가 zum.com을 방문시 gif 파일을 통해 메세지 애니메이션이 시작하도록 하는 캠페인이였습니다. <br/>
기능에 대한 상세 기능은 아래와 같습니다.

* 사용자가 방문할때마다 애니메이션이 **새로** 시작되어야 한다.
* 애니메이션이 끝나면 **새로고침 해야만** 다시 애니메이션이 시작되어야 한다.

보기엔 크게 문제가 없어보이는 기능이였습니다. <br/>
아주 편안한 마음으로 gif를 추가하고 테스트를 진행하였는데... <br/>
**새로고침하면 gif가 시작하지 않는것** 입니다.

![엉엉](./images/엉엉.png)

(엉엉 ㅠㅠㅠ)<br/>
이유를 찾아보니 gif의 경우 웹 페이지에서 로딩이 되어 웹 브라우저에 **캐시 된 이후에는 애니메이션이 종료된 이미지만** 볼 수 있는 것입니다. <br/>
한번 밖에 보지 못하는 gif는 있을수 없기에 여러 방법을 찾아보았지만, 결국 **새로고침 할때마다 gif를 다시 부르는 수밖에** 없다는 결론을 내렸습니다. <br/><br/>

일반적으로 웹 사이트에서는 gif/image/css/js 등과 같은 정적 자원(static resource)들은 브라우저 캐시를 통해 트래픽의 부담을 줄이고 사이트의 성능도 향상시킬 수 있습니다. <br/>
헌데, 위 제시한 방법처럼 페이지 reload가 있을때마다 gif를 다시 부르는 방법은 이러한 브라우저 캐시를 포기하는 것이기 때문에 일반적인 상황이라면 절대 사용해서는 안됩니다. <br/>


### 404 캐시 문제

### 설치 및 설정관련
[Virtual box에 centos설치하기](http://webdevnovice.tistory.com/2) <br/>
이거 최고다 전부 따라가면서 설치하면 된다. <br/>

[Nginx 캐시 설명](http://www.joinc.co.kr/w/man/12/nginx/static) <br/>


80, 8080포트를 오픈하자

![80,8080포트오픈](./images/8080포트오픈.png)

![proxy.conf](./images/proxy-conf.png)
