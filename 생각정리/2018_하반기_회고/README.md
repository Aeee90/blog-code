# 2018년 하반기 회고

![intro](./images/intro.png)

([상반기](https://jojoldu.tistory.com/332)엔 H2를 메인으로 썼으니, 하반기엔 [소라의날개로](https://coupa.ng/bgiYTx)..)  
  
## 회사

하반기엔 큰 작업과 내년을 대비하는 작업들로 채운것 같다.  

### 8 ~ 10월 - 신 주문 시스템 TF 합류

하반기에 우리 실 (팀의 상위 조직) 최대 과제는 **주문 시스템 개편**이였다.  
  
우리팀의 모든 서비스가 주문시스템과 엮여 있던 상태다보니 **주문 시스템이 얼마나 큰지, 얼마나 많은 시스템과 연결**되어있는지도 알고 있었다.  
작은거 하나도 고치는게 얼마나 힘든지도 계속 보고 있었다.  
(공교롭게도 자리도 바로 옆이라서)  
  
하반기 일정을 듣다가 이 시스템을 **3개월만에 개편**해야하는 일정을 들었다.  
대박이라는 생각과 함께 **우리팀 일은 아니라서** 애도를 표했다.  
  
"와.. 저기 진짜 풀야근이겠다 어떡하냐"  
"우리팀에 요청 오면 많이 도와드려야겠다"  
등등의 생각등을 했었다.  
**주문팀으로 옮겨간 우리팀분**과 같이 커피도 마시면서 위로도 해줬다.  
  
근데 그 친구가 커피 마시다가 이상한 얘기를 했는데...  
**"어 이야기 못들으셨어요?"** 라고 했다.  
엥 무슨 이야기지?? 싶었다.  
  
며칠 뒤, 주문팀으로 옮긴 전 팀장님이 따로 나를 부르셨다.  
(즉, **팀에서 2분이** 주문팀으로 갔다ㅠㅠ)  
  
전 팀장님은 일정안에 끝내기 힘들것 같으니 **TF로 와서 같이하자고** 하셨다.  
이미 실장님과 우리팀 팀장님과도 얘기가 다 된 상태라는 얘기도 함께 말이다.  
![call](./images/call.png)

(띠용?)  
  
그리고 몇분뒤 **우리팀 팀장님도 오셔서** 주문팀 가서 일을 도와줘야겠다고 하셨다.  
  
남의집 불구경 하는 마음이였다가 이게 뭔가 싶기도 하고, **내가 뭘 도와드릴수 있을까**라는 근본적 의문이 생겼다.  
  
그 팀의 **상세한 도메인을 모르는 나**로서는 어떤걸 도와드려야하나 난감하다.  
괜히 인원수만 채운다거나, 기대감만 드리는것 같아서 좀 부담스럽기도 했다.  
  
일단은 **내가 할 수 있는 것부터 해야겠다**고 생각했다.  

다들 본인의 일로 바쁘기 때문에 **코드리뷰에 적극적으로 참가했다**.  
도메인을 모르니 자세한 비지니스 로직보다는 코드상 오류나 컨벤션, 클린 코드, 테스트 코드 위주로 리뷰를 했다.  
  
코드 리뷰 외에 개발 작업으로는 **Batch 작업을 전반적으로** 구현했다.  
  
비교적 변경이 거의 없는 테이블 (지역정보, 업주정보, 업소정보 등등)들의 전체 이관 Batch작업이나, 실시간 데이터 복사 작업과 그에 대한 검증 배치등을 만들기도 했다.  
  
이때 **주문 시스템에 Batch 환경을 구축**했다.  
  
당시에 우리팀은 모든 서비스가 Batch 작업이 수십개씩 있었다.  
  
다 합치면 수백개는 될 텐데, 이들을 관리하면서 느낀 점은 **Spring Batch Job들을 Jenkins로 관리하는게 가장 효율적**이라는 것이다.  
  
그래서 신 주문 시스템의 전반적인 배치 환경을 구축했다.  
그리고 대부분의 Batch 작업들을 구현해서 다른 분들이 Spring Batch를 사용하는데 가이드가 되었다.  
  
10월이 오픈이였기 때문에 갈수록 시간이 촉박했었다.  
  
**9월 추석연휴가 대박**이였는데, 추석 연휴가 시작되기 전날, 주문팀장님은 신규 시스템이 제대로 작동하는지 확인하기 위해 **검증 배치**를 만들라 하셨다.  
즉, 오픈후 신/구 시스템 양쪽에 **동시에 데이터가 저장되면 제대로 저장되는지 전체 검증**하는 배치가 필요한 것이다.  
그래야 오픈하고 나서도 계속 제대로 로직이 수행되는지 확인할수 있기 때문이다.  
  
고향인 대구에 내려가서 **차례지내는 시간 외에는 모두 카페가서 작업**을 진행했다.  
  
주문 팀장님과는 1년 넘게 일했었지만, 이렇게 **확고하고 강하게 작업 완료를 요청하신건 이때가 처음**이기 때문이다.  
  
팀장님이 정말 진지한 표정을 지으시면서 얘기하셔서 **이거 못끝내면 진짜 큰일나나보다** 싶었다.  
**추석연휴에도 밤 12시까지** 작업했었다.  
친척분들은 뭐가 그렇게 일이 많냐고 하시는데 속타 죽는줄 알았다.  
이게 **만약 정산이였다면, 포인트였다면** 이렇게 오래 걸리지 않았을거다.  
  
뭐랄까 **안개속을 걷는 기분**이였다.  

![fog](./images/fog.png)

**도메인을 모른채로 레거시 데이터와 신규 모델 데이터를 검증**하는 배치를 만드는건 그런 것이였다.  
  
구/신 테이블이 딱 1:1 관계면 얼마나 좋을까  

그런 아름다운 상황은 없고, 

* 테이블 구조가 완전히 달라 (레거시는 1인데, 신규 모델은 1:N으로 나눠야 되는 테이블) 비교할 필드가 어디에 매핑되야할지도 몰랐고
* 그냥 필드만 매핑되는게 아니라 계산된 값을 써야할때도 있었고 
* 이 계산 로직이 프로젝트에 없고 프로시져에 있기도 해서 수백개의 프로시져 스토어를 뒤져보기도 했다.

코드와 프로시져 까보다가 도저히 안되겠다 싶어서, **그 팀에서 정말 도메인을 꽉 잡고 계신분께 연락** 드렸다.

> 이후에 이분은 올해 하반기 우수사원을 받으셨다.

정말 죄송스럽게도 **밤 12시까지 붙잡고 여쭤보고 테스트 코드를 작성**했다.  
  
원했던 모든 검증 배치를 만들고 나니 추석연휴 끝날이였다.  
그래도 제시간에 일을 끝낼 수 있어서 연휴 다음날, 아침 미팅때 완료 보고를 할 수 있었으니 정말 다행이였다.  
  
여튼 이번 개편까지 벌써 **3번째 레거시 시스템 개편**에 참여하고 함께 **완료를 경험**했다.  
  
개인적으론 정말 뿌듯하다.  
레거시 시스템 개편을 할때 어떻게 계획을 잡고, 어떻게 비지니스 로직과 데이터를 검증하고, 모델링을 어떻게 해야할지 하나둘씩 배워가고 있다.  
  
뭐 그렇다고 엄청 잘하게 되었다 이런건 아니고.  
어찌됐든 또 하나의 큰 프로젝트를 경험하고 완료할수 있어서 너무 즐거운 시간이였다.

### 11 ~ 12월 - 정산 / 포인트 운영

신주문 TF가 끝나고, 우리팀 밀린 숙제들을 쳐냈다.  
밀린 포인트 후속 작업들 (SAP, 배민 키친, 배민 마켓 연동 등)을 쭈욱 진행했고,  
정산 쪽도 밀린 작업들을 12월에 쳐냈다.  
  
특히 정산쪽엔 큰 작업 하나가 있었다.  
내년 1월에 큰 프로젝트가 오픈 되는데, 이를 대비해서 12월에 **운영 환경의 테이블들에 컬럼 추가**가 필요했다.  
  
데이터가 적을때야 ```alter``` 한번 치는게 무슨 큰일인가 싶지만, **몇억건이 되면 일이되더라**.  
  
정산은 주요 테이블들이 다 **3~4억건 이상** 인 상태였던 것이다.  
  
DB 서버 성능 자체가 그리 좋은 편도 아니였고,  
AWS와 같은 클라우드를 쓰고 있지도 않아서 성능 올리기도 쉬운일이 아니였다.  
그러다보니 지금 사양에서 처리를 해야만 했다.  
  
혹시 몰라 테스트로 지금 서버와 비슷한 사양의 RDS에서 같은 양으로 테스트를 해보니 **6시간이 지나도 끝나지 않았다**  
  
> 인덱스, FK에 따라 결과는 다릅니다.
  
이래서는 안될것 같아 고민하던중, 팀원분께 한가지 조언을 받았다.  
**pt-online-schema-change**로 해보라고.  

> 참고: [pt-online-schema-change 튜토리얼](https://jojoldu.tistory.com/358)
  
포인트 시스템의 데이터 양이 정산과 비슷해서 [스냅샷으로 테스트용 DB를 만들고](https://jojoldu.tistory.com/333) 정산 DB와 비슷한 사양의 RDS를 생성해서 주말에 신나게 테스트 했다.  
  
테스트 해보니 괜찮았다.  
**자식 테이블이 데이터가 1억건 이하일때만**  
  
자식 테이블의 데이터가 일정양 이상일 경우 **FK가 새로 만들어져 기존 FK를 쓸수가 없었다**.  
옵션을 강제로 기존걸 유지하도록 하면 자식테이블 반영이 오래걸려 못쓰겠더라.

> 뭐 결국 ```create table```로 처리하는거니깐 당연한 결과다

그래서 어떻게 할까 고민하다가, 같이 정산을 담당하는 분이 아이디어를 주셨다.  

> 사실 포인트도 주요 테이블들이 4~5억건을 넘어서 컬럼 추가가 필요하면 같은 방법을 쓸것 같다.
  
내년 4월까지 일정이 꽉 차있다.  
정말루!  
진짜 큰 프로젝트 2개가 정산쪽에 꽉 잡혀있고,  
다른 팀 지원을 위한 포인트 일들이 잡혀있다.  
포인트는 아마 정산 때문에 밀릴수도 있는데, 어떻게 될지 또 모르지 뭐.  
내년 회고에도 쓸 얘기는 넘칠것 같다.

> 내년 4월이 지나면 안바쁠까?  
4월까지 이 프로젝트 때문에 계속해서 미루던 일들이 4월 지나서 쭉쭉 요구되겠지?  
바쁜건 상관 없는데, 내년에 하는 일들은 나를 성장시키는 업무들일까?  
내년에 나는 성장할 수 있을까?

## 블로그

블로그엔 아주 큰일이 있었다.  
사실 상반기에 있었던 일인데, 상반기 회고에서 잊고 작성을 안해서 하반기 회고에 작성한다.  
그 큰일이란..  
[Hibernate 뉴스레터 블로그](http://in.relation.to/2018/05/25/hibernate-community-newsletter-2018-10/)에 **내 블로그가 링크** 되었다.

![하이버네이트뉴스레터](./images/hibernate.png)

(For our Korean reader, this article 이라고 되어있는 부분이다!!)  
  
정말 기뻤다!  
좀 더 

그리고 티스토리가 통계 개편이 되면서 갑자기 방문자수가 급증했다.  

![blog-view](./images/blog-view.png)

1 ~ 7월까지 72개의 글을 썼고, 8 ~ 12월까지 42개의 글을 썼다.  
즉, 올해는 총 114개의 글을 썼다.  

* 8월: 9
* 9월: 8
* 10월: 9
* 11월: 6
* 12월: 10
  
## 오픈소스

Spring에 PR을 2개를 보냈었다.

* Spring Rest Docs PR
* Spring Batch PR
  
보내긴 했는데...  
아쉽게도 **Spring Batch PR은 빠졌다**.  
버그는 확실한데, 이 버그가 단순히 Spring Batch만 수정해서 될 게 아니라, **Spring Boot도 같이 수정이 필요**하다는 것이다.

![spring-batch](./images/spring-batch.png)

([Spring Batch PR](https://github.com/spring-projects/spring-batch/pull/625))  
  
내가 수정한건 보다 훨씬 더 큰 건이라고 하니 더 찾아보진 않고 포기했다.  
다른 하고 싶은것들도 많아서 더 매달릴순 없었다.  
얼른 해결해주길 바래본다.  

## 교육

* [DEVOPS로 활용하는 클라우드 플랫폼 WORKSHOP](https://www.fastcampus.co.kr/data_camp_cpb/)

## 발표

* [11월 JetBrains Day](https://info.jetbrains.com/jetbrains-day-seoul-2018.html)
* [12월 마소콘](https://www.imaso.co.kr/masocon2018/)

## 내년에는?

일단 교육 하나를 신청했다.  

* [김성박님의 스프링부트를 활용한 쇼핑몰 프로젝트 CAMP](https://www.fastcampus.co.kr/dev_camp_sbw/)

과정내에서 커리큘럼은 대부분 알고 있는 내용들이긴하다.  
  
다만 내가 제대로 알고 있는지도 궁금하고,  
김성박님은 도대체 어떻게 사람들를 가르칠까 궁금했다.  

> 이게 제일 큰 이유이긴 한다.

